series:
  type: table
  displayName: Series
  order: '10'
  besql: true
  primaryKey: ID
  scheme:
    columns:
    - ID:
        type: KEYTYPE
        autoIncrement: true
        primaryKey: true
    - GSE:
        type: VARCHAR(10)
    - PMID:
        type: KEYTYPE
    - organism:
        type: KEYTYPE
        reference: organisms
    - type:
        type: VARCHAR(10)
    - title:
        type: VARCHAR(500)
    - description:
        type: VARCHAR(4000)
    - design:
        type: VARCHAR(4000)
  queries:
  - '*** Selection view ***':
      type: 1D
      code: |-
          SELECT ID AS "ID", 
          GSE AS "Name"
          FROM series
  - All records:
      defaultView: true
      type: 1D
      roles: '@AllRoles'
      operations:
      - AddRemoveCategory
      - Filter
      code: |-
          SELECT
            s.ID AS "___ID",
            s.GSE AS "GSE",
            -- '<a href="#!series/' || s.ID || '">' || s.title || '</a>' AS "Title",
            s.title AS "Title",
            '<link table="series" queryName="Details" using="___ID" columns="ID" />' AS ";Title",
            o.title AS "Organism;<quick visible='true' />",
            s.type AS "Type",
            s.description AS "Description;<quick visible='false' />"
          FROM series s
          LEFT JOIN organisms o ON o.id = s.organism
  - Details:
      layout: '{"tableBox":"series", "mode":"named", "hideTitle":"true"}'
      invisible: true
      roles: '@AllRoles'
      code: |-
          SELECT
            s.ID AS "ID",
            'Series ' || s.GSE AS "PageTitle",
            s.GSE AS "GSE",
            s.title AS "Title",
            o.title AS "Organism",
            s.type AS "Type"
          FROM series s
          LEFT JOIN organisms o ON o.id = s.organism
          WHERE (1=1)
          <if parameter="ID">
              AND s.ID = <parameter:ID/>
          </if>
  - Description:
      layout: '{"tableBox":"seriesDescription", "mode":"named", "hideTitle":"true"}'
      invisible: true
      roles: '@AllRoles'
      code: |-
          SELECT
            s.ID AS "ID",
            s.description AS "Description",
            s.design AS "Design",
            s.GSE AS "GSE",
            s.PMID AS "PMID"
          FROM series s
          WHERE s.ID = <parameter:ID/>
  - Individs:
      type: 1D_unknown
      layout: '{"hideTitle":"true", "defaultPageLimit":30}'
      invisible: true
      roles: '@AllRoles'
      code: |-
          SELECT DISTINCT
            i.code AS "Code",
            i.age AS "Age",
            i.sex AS "Sex",
            i.stage AS "Stage",
            i.state AS "State",
            i.comment AS "Comment"
          FROM series s 
          INNER JOIN samples ON samples.series = s.ID
          INNER JOIN biosamples b ON b.ID = samples.biosample 
          INNER JOIN individuals i ON i.ID = b.individual
          WHERE s.ID = <parameter:ID/>
          ORDER BY i.code              
  - Conditions:
      type: 1D_unknown
      layout: '{"hideTitle":"true", "defaultPageLimit":30}'
      invisible: true
      roles: '@AllRoles'
      code: |-
          SELECT DISTINCT
            c.id AS "ID",
            c.title AS "Title",
            t.title AS "Treatment",
            t.description AS "Treatment details;<quick visible='false' />",
            t.comment AS "Treatment comment;<quick visible='false' />",
            c.timePoint AS "Time point (min)",
            c.status AS "Status",
            c.comment AS "Comment"
          FROM series s 
          INNER JOIN samples ON samples.series = s.ID
          INNER JOIN biosamples b ON b.ID = samples.biosample 
          INNER JOIN conditions c ON c.ID = b.condition
          LEFT JOIN treatments t ON t.ID = c.treatment
          WHERE s.ID =1
          order by c.ID 
  operations:
  - AddRemoveCategory:
      records: 2
      roles: Annotator
      code: com.developmentontheedge.be5.modules.core.operations.categories.AddRemoveCategory
  - Filter:
      roles: Administrator
      layout: '{"type":"modalForm"}'
      code: com.developmentontheedge.be5.server.operations.FilterOperation
